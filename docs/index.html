<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Causal Inference for a Binary Treatment and Continuous Outcome
        using Bayesian Causal Forests • bcf2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Causal Inference for a Binary Treatment and Continuous Outcome
        using Bayesian Causal Forests">
<meta property="og:description" content="Causal inference for a binary treatment and continuous outcome using Bayesian Causal Forests. See Hahn, Murray and Carvalho (2017) &lt;arXiv:1706.09523&gt; for additional information. This implementation relies on code originally accompanying Pratola et. al. (2013) &lt;arXiv:1309.1906&gt;.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">bcf2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/simple-example.html">A Simple Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="bayesian-causal-forests" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#bayesian-causal-forests" class="anchor"></a>Bayesian Causal Forests</h1></div>
<p>Welcome to the BCF site! This page provides more details on this implementation of Bayesian causal forests (BCF).</p>
<div id="why-bcf" class="section level2">
<h2 class="hasAnchor">
<a href="#why-bcf" class="anchor"></a>Why BCF?</h2>
<p>BCF is a cutting-edge causal inference methodology that builds on Bayesian Additive Regression Trees (BART, Chipman, George, and McCulloch 1998). BART and BCF both combine Bayesian regularization with regression trees to provide a highly flexible response surface that, thanks to the Bayesian regularizing priors, is not overfit to the training data. BCF further extends BART’s flexibility by specifying different models for relationships between covariates and the outcome and relationships between covariates and the treatment effect. For more information, you can find the original BCF paper here: <a href="https://arxiv.org/pdf/1706.09523.pdf">https://arxiv.org/pdf/1706.09523.pdf</a>.</p>
<p>BCF performs remarkably well in simulation and has led the pack at recent rigorous causal inference competitions, such as those held at the Atlantic Causal Inference Conference. This implementation further extends existing BCF functionality by:</p>
<ul>
<li>allowing for heteroskedastic error</li>
<li>automating multi-chain, multi-core implementations</li>
<li>providing a suite of convergence diagnostic functions via the <code>{coda}</code> package</li>
<li>accelerating some underlying computations, resulting in shorter runtimes</li>
</ul>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<p>If you are just getting started with BCF, we recommend starting with the tutorial vignette and the examples throughout the package documentation.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>This package requires compilation, so make sure you have Rtools properly installed – details <a href="https://cran.r-project.org/bin/windows/Rtools/">here</a>.</p>
<p>Install the latest release from CRAN:</p>
<pre class="{r}"><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("bcf")</a></code></pre>
<p>Install the latest development version from GitHub:</p>
<pre class="{r}"><code>if (!require("devtools")) {
  install.packages("devtools")
}
devtools::install_github("jaredsmurray/bcf")</code></pre>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<pre class="{r}"><code>set.seed(1)

p &lt;- 3 # two control variables and one effect moderator
n &lt;- 1000
n_burn &lt;- 1000
n_sim &lt;- 1000

x &lt;- matrix(rnorm(n*p), nrow=n)


# create targeted selection, whereby a unit's likelihood of joining the intervention (pi) is related to its expected outcome (mu)
q &lt;- -1*(x[,1]&gt;(x[,2])) + 1*(x[,1]&lt;(x[,2])) -0.1

# generate treatment variable
pi &lt;- pnorm(q)
z &lt;- rbinom(n,1,pi)

# tau is the true treatment effect. It varies across units as a function of
# X3, the effect moderator
tau &lt;-  1/(1 + exp(-x[,3]))

mu &lt;- q

# generate the response using q, tau and z
y_noiseless &lt;- mu + tau*z

# set the noise level relative to the expected mean function of Y
sigma &lt;- diff(range(mu + tau*pi))/8

# draw the response variable with additive error
y &lt;- y_noiseless + sigma*rnorm(n)

weights &lt;- 1000.0*rep(1, n)

bcf_out &lt;- bcf2::bcf(y            = y,
                 z                = z,
                 x_control        = x,
                 x_moderate       = x,
                 pihat            = pi,
                 nburn            = n_burn,
                 nsim             = n_sim,
                 w                = weights,
                 n_chains         = 4,
                 n_chain_clusters = 2,
                 random_seed      = 1,
                 update_interval  = 1)
</code></pre>
<pre class="{r}"><code>bcf2::summarise_bcf(bcf_out)

mean_square_error &lt;- function (x,y){
  mean((x-y)^2)
}</code></pre>
<pre class="{r}"><code>assess_closeness &lt;- function(x,y, title){
  cat("Assessing Cloesness of ", title, "\n")
  
  mse = mean_square_error(x,y)
  
  print("MSE")
  print(mse)
  
  print("Error")
  print(sqrt(mse)/abs(mean(x)))
}

mu_correct = bcf_out$yhat - t(t(bcf_out$tau)*z)

print("Y Mean")
print(mean(y))

print("Tau Mean")
print(mean(tau))

print("mu Mean")
print(mean(mu))

assess_closeness(bcf_out$mu,mu_correct,'mu_compare')</code></pre>
</div>
<div id="latest-package-updates-weights" class="section level2">
<h2 class="hasAnchor">
<a href="#latest-package-updates-weights" class="anchor"></a>Latest package updates: weights</h2>
<p>The original version of {bcf} does not allow for weights. In the new version, the model is specified as follows:</p>
<p><code>y_i∼N(μ(x_i)+τ(x_i ) z_i,σ^2/w_i )</code></p>
<p>We changed several parts of the code to incorporate these weights:</p>
<ul>
<li>Code to calculate sufficient statistics</li>
<li>Code to update leaf node means</li>
<li>Code to update variance across leaf node means</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing bcf2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Jared S. Murray <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Jared S. Murray.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
